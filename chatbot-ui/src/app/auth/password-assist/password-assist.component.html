<div class="page-bg">
  <!-- =================== FORGOT =================== -->
  <div class="dual-wrap" *ngIf="view === 'forgot'">
    <section class="hero">
      <h5 class="kicker">Sécurité du compte</h5>
      <h1 class="title-xl">Réinitialiser votre mot de passe</h1>
      <p class="sub">Saisissez votre adresse e-mail pour recevoir un lien sécurisé.</p>
    </section>

    <section class="card">
      <div class="brand"><span class="material-icons">mark_email_unread</span></div>
      <h2 class="card-title">Mot de passe oublié</h2>
      <p class="muted">Nous vous envoyons un lien valide 24h.</p>

      <div class="notice success" *ngIf="noticeSent">
        <span class="material-icons">check_circle</span>
        <div>
          <div class="n-title">Lien envoyé</div>
          <div class="n-sub">Vérifie ta boîte de réception et tes spams.</div>
        </div>
      </div>

      <form (ngSubmit)="submitForgot()">
        <label class="label">Email</label>
        <div class="input">
          <span class="material-icons">mail</span>
          <input type="email" [(ngModel)]="email" name="email" placeholder="vous@exemple.com" required />
        </div>

        <div class="row gap">
          <button type="submit" class="btn primary" [disabled]="loading || !email">
            <span class="material-icons" *ngIf="!loading">send</span>
            <span class="spinner" *ngIf="loading"></span>
            <span>{{ loading ? 'Envoi…' : 'Envoyer le lien' }}</span>
          </button>

          <button type="button" class="btn" [disabled]="countdown>0" (click)="resend()">
            <span class="material-icons">restart_alt</span>
            <span>{{ countdown>0 ? ('Renvoyer dans ' + countdown + 's') : 'Renvoyer' }}</span>
          </button>
        </div>

        <p class="small center"><a routerLink="/login">Retour à la connexion</a></p>
      </form>
    </section>
  </div>

  <!-- =================== VERIFICATION / INVALID =================== -->
  <div class="center-wrap" *ngIf="view === 'verifying' || view === 'invalid'">
    <section class="card narrow center">
      <div *ngIf="view==='verifying'" class="spinner lg"></div>
      <div *ngIf="view==='invalid'" class="icon bad"><span class="material-icons">error</span></div>
      <h2>{{ view==='verifying' ? 'Vérification du lien…' : 'Lien invalide' }}</h2>
      <p *ngIf="view==='invalid'">Le lien est expiré ou incorrect.</p>
      <div *ngIf="view==='invalid'" class="row gap">
        <button class="btn" (click)="view='forgot'">Demander un nouveau lien</button>
        <a class="btn ghost" routerLink="/login">Retour connexion</a>
      </div>
    </section>
  </div>

  <!-- =================== RESET (centré – celui que tu veux) =================== -->
  <div class="center-wrap" *ngIf="view === 'reset'">
    <section class="card reset-card">
      <div class="brand top"><span class="material-icons">vpn_key</span></div>
      <h2 class="card-title">Définir un nouveau mot de passe</h2>
      <p class="muted">Saisis l’adresse e-mail du compte et un mot de passe fort.</p>

      <form (ngSubmit)="submitReset()">
        <label class="label">Email du compte</label>
        <div class="input">
          <span class="material-icons">mail</span>
          <input type="email" [(ngModel)]="email" name="reset_email" required placeholder="vous@exemple.com" />
        </div>

        <label class="label with-right">
          Nouveau mot de passe
          <span *ngIf="password" class="badge"
                [class.bad]="strength(password)<=2"
                [class.mid]="strength(password)===3"
                [class.ok]="strength(password)>=4">
            {{ strength(password)<=2 ? 'faible' : (strength(password)===3 ? 'moyen' : 'fort') }}
          </span>
        </label>
        <div class="input">
          <span class="material-icons">lock</span>
          <input [type]="showPw?'text':'password'" [(ngModel)]="password" name="pw" required placeholder="8+ caractères, Aa1@" />
          <button type="button" class="ghost-ic" (click)="showPw=!showPw" aria-label="Afficher/masquer">
            <span class="material-icons">{{ showPw?'visibility_off':'visibility' }}</span>
          </button>
        </div>
        <div class="strength"><div class="bar" [style.width.%]="(strength(password)/5)*100"></div></div>

        <label class="label">Confirmer le mot de passe</label>
        <div class="input">
          <span class="material-icons">lock</span>
          <input [type]="showConfirm?'text':'password'" [(ngModel)]="confirm" name="confirm" required placeholder="Répète le mot de passe" />
          <button type="button" class="ghost-ic" (click)="showConfirm=!showConfirm" aria-label="Afficher/masquer">
            <span class="material-icons">{{ showConfirm?'visibility_off':'visibility' }}</span>
          </button>
        </div>

        <div *ngIf="error" class="alert error">
          <span class="material-icons">error</span><span>{{ error }}</span>
        </div>

        <button type="submit" class="btn primary wide" [disabled]="loading || !email || !password || !confirm">
          <span class="material-icons" *ngIf="!loading">save</span>
          <span class="spinner" *ngIf="loading"></span>
          <span>{{ loading ? 'Enregistrement…' : 'Enregistrer' }}</span>
        </button>

        <p class="small center"><a routerLink="/login">Retour à la connexion</a></p>
      </form>
    </section>
  </div>

  <!-- =================== SUCCESS (centré) =================== -->
  <div class="center-wrap" *ngIf="view === 'success'">
    <section class="card narrow center">
      <div class="icon ok"><span class="material-icons">check_circle</span></div>
      <h2>Mot de passe changé</h2>
      <p>Tu peux maintenant te connecter avec ton nouveau mot de passe.</p>
      <a routerLink="/login" class="btn primary">Se connecter</a>
    </section>
  </div>
</div>
