<div class="page-bg">

  <!-- Vérif/Invalid -->
  <div class="center-wrap" *ngIf="view === 'verifying' || view === 'invalid'">
    <section class="card narrow center">
      <div *ngIf="view==='verifying'" class="spinner lg"></div>
      <ng-container *ngIf="view==='invalid'">
        <div class="icon bad"><span class="material-icons">error</span></div>
        <h2 class="card-h2">Lien invalide</h2>
        <p class="card-muted">Ce lien est expiré ou incorrect.</p>
        <a class="btn ghost" routerLink="/login">Retour à la connexion</a>
      </ng-container>
    </section>
  </div>

  <!-- RESET -->
  <div class="center-wrap" *ngIf="view === 'reset'">
    <section class="card reset-card">
      <div class="brand top"><span class="material-icons">vpn_key</span></div>
      <h2 class="card-title">Définir un nouveau mot de passe</h2>
      <p class="muted">Saisis l’adresse e-mail du compte et un mot de passe fort.</p>

      <form (ngSubmit)="submitReset()">
        <label class="label">Email du compte</label>
        <div class="input">
          <span class="material-icons">mail</span>
          <input type="email" [(ngModel)]="email" name="reset_email" required placeholder="vous@exemple.com" />
        </div>

        <label class="label with-right">
          Nouveau mot de passe
          <span *ngIf="password" class="badge"
                [class.bad]="strength(password)<=2"
                [class.mid]="strength(password)===3"
                [class.ok]="strength(password)>=4">
            {{ strength(password)<=2 ? 'faible' : (strength(password)===3 ? 'moyen' : 'fort') }}
          </span>
        </label>
        <div class="input">
          <span class="material-icons">lock</span>
          <input [type]="showPw?'text':'password'" [(ngModel)]="password" name="pw" required placeholder="8+ caractères, Aa1@" />
          <button type="button" class="ghost-ic" (click)="showPw=!showPw" aria-label="Afficher/masquer">
            <span class="material-icons">{{ showPw?'visibility_off':'visibility' }}</span>
          </button>
        </div>
        <div class="strength"><div class="bar" [style.width.%]="(strength(password)/5)*100"></div></div>

        <label class="label">Confirmer le mot de passe</label>
        <div class="input mb-12">
          <span class="material-icons">lock</span>
          <input [type]="showConfirm?'text':'password'" [(ngModel)]="confirm" name="confirm" required placeholder="Répète le mot de passe" />
          <button type="button" class="ghost-ic" (click)="showConfirm=!showConfirm" aria-label="Afficher/masquer">
            <span class="material-icons">{{ showConfirm?'visibility_off':'visibility' }}</span>
          </button>
        </div>

        <div *ngIf="error" class="alert error">
          <span class="material-icons">error</span><span>{{ error }}</span>
        </div>

        <button type="submit" class="btn primary wide" [disabled]="loading || !email || !password || !confirm">
          <span class="material-icons" *ngIf="!loading">save</span>
          <span class="spinner" *ngIf="loading"></span>
          <span>{{ loading ? 'Enregistrement…' : 'Enregistrer' }}</span>
        </button>

        <p class="small center"><a routerLink="/login">Retour à la connexion</a></p>
      </form>
    </section>
  </div>

  <!-- Succès -->
  <div class="center-wrap" *ngIf="view === 'success'">
    <section class="card narrow center">
      <div class="icon ok"><span class="material-icons">check_circle</span></div>
      <h2>Mot de passe changé</h2>
      <p>Tu peux maintenant te connecter avec ton nouveau mot de passe.</p>
      <a routerLink="/login" class="btn primary">Se connecter</a>
    </section>
  </div>
</div>
